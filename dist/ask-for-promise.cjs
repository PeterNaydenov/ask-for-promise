"use strict";function e(e){let o,r=!1;return e?(o=function(e){let o=e.map((e=>n())),r=o.map((e=>e.promise));return o.promises=r,o.onComplete=t(Promise.all(r)),o}(e),r=!0):o=n(),o.timeout=function(e,n){let o;o=e?Promise.all(n.promises):n.promise;return function(e,r){let i,u=new Promise(((n,t)=>{i=setTimeout((()=>{n(r),Promise.resolve(o)}),e)}));return o.then((()=>clearTimeout(i))),n.onComplete=t(Promise.race([o,u])),n}}(r,o),o}function n(){let e,n;const o=new Promise(((t,o)=>{e=t,n=o}));return{promise:o,done:e,cancel:n,onComplete:t(o)}}function t(e){return function(n){e.then((e=>n(e)))}}e.sequence=function(n,...t){const o=e(),r=[];const i=function*(e){for(const n of e)yield n}(n);return function e(n,...t){n.done?o.done(r):n.value(...t).then((n=>{r.push(n),e(i.next(),...t,n)}))}(i.next(),...t),o},e.all=function(n,...t){const o=e(),r=[],i=n.map(((e,n)=>"function"==typeof e?e(...t).then((e=>r[n]=e)):e.then((e=>r[n]=e))));return Promise.all(i).then((()=>o.done(r))),o},module.exports=e;
