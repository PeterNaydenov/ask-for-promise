function e(e){let t,r=!1;return e?(t=function(e){let t=e.map((e=>n())),r=t.map((e=>e.promise));return t.promises=r,t.onComplete=o(Promise.all(r)),t}(e),r=!0):t=n(),t.timeout=function(e,n){let t;t=e?Promise.all(n.promises):n.promise;return function(e,r){let i,s=new Promise(((n,o)=>{i=setTimeout((()=>{n(r),Promise.resolve(t)}),e)}));return t.then((()=>clearTimeout(i))),n.onComplete=o(Promise.race([t,s])),n}}(r,t),{promise:t.promise?t.promise:null,promises:t.promises?t.promises:null,done:t.done,cancel:t.cancel,onComplete:t.onComplete,timeout:t.timeout}}function n(){let e,n;const t=new Promise(((o,t)=>{e=o,n=t}));return{promise:t,promises:null,done:e,cancel:n,onComplete:o(t)}}function o(e){return function(n){e.then((e=>n(e)))}}e.sequence=function(n,...o){const t=e(),r=[];const i=function*(e){for(const n of e)yield n}(n);return function e(n,...o){n.done?t.done(r):n.value(...o).then((n=>{r.push(n),e(i.next(),...o,n)}))}(i.next(),...o),t},e.all=function(n,...o){const t=e(),r=[],i=n.map(((e,n)=>"function"==typeof e?e(...o).then((e=>r[n]=e)):e.then((e=>r[n]=e))));return Promise.all(i).then((()=>t.done(r))),t};export{e as default};
